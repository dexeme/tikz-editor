<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor TikZ com Vue</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div id="app" v-cloak>
    <header class="app-header">
      <div>
        <h1>Editor Interativo de Grafos TikZ</h1>
        <p class="subtitle">Construa diagramas com mais rapidez usando o poder do Vue.</p>
      </div>
      <div class="header-actions">
        <button class="ghost" @click="resetGraph" :disabled="!canReset">Reiniciar</button>
        <button class="primary" @click="copyToClipboard" :disabled="!tikzCode">Copiar TikZ</button>
      </div>
    </header>

    <main class="app-body">
      <section class="workspace">
        <div class="toolbar" role="radiogroup" aria-label="Ferramentas de edição">
          <button
            v-for="tool in tools"
            :key="tool.mode"
            type="button"
            :aria-pressed="mode === tool.mode"
            :class="['tool-btn', mode === tool.mode ? 'active' : '', tool.accent]"
            @click="changeMode(tool.mode)"
          >
            <span class="tool-icon">{{ tool.icon }}</span>
            <span class="tool-label">{{ tool.label }}</span>
          </button>
        </div>

        <div class="canvas-wrapper">
          <canvas
            ref="canvasRef"
            width="1280"
            height="720"
            @mousedown="onCanvasMouseDown"
            @mousemove="onCanvasMouseMove"
            @mouseup="onCanvasMouseUp"
            @mouseleave="onCanvasMouseUp"
          ></canvas>
          <p class="canvas-hint">Clique no canvas para {{ currentHint }}</p>
        </div>

        <div class="panel-grid">
          <section class="panel">
            <header><h2>Detalhes do Nó</h2></header>
            <div v-if="selected?.type === 'node'" class="panel-content">
              <label>
                Texto
                <input type="text" v-model="selected.item.label" @input="invalidateTikz">
              </label>
              <label>
                Cor de preenchimento
                <input type="color" v-model="selected.item.color" @input="invalidateTikz">
              </label>
              <label>
                Forma
                <select v-model="selected.item.shape" @change="invalidateTikz">
                  <option value="circle">Círculo</option>
                  <option value="rectangle">Retângulo</option>
                </select>
              </label>
              <label>
                Tamanho da fonte
                <select v-model="selected.item.fontSize" @change="invalidateTikz">
                  <option value="12">Pequena</option>
                  <option value="16">Média</option>
                  <option value="20">Grande</option>
                </select>
              </label>
              <button class="ghost" @click="removeSelected">Remover Nó</button>
            </div>
            <div v-else class="empty-state">Selecione um nó para editar seus detalhes.</div>
          </section>

          <section class="panel">
            <header><h2>Detalhes da Aresta</h2></header>
            <div v-if="selected?.type === 'edge'" class="panel-content">
              <label>
                Estilo de linha
                <select v-model="selected.item.style" @change="invalidateTikz">
                  <option value="solid">Sólida</option>
                  <option value="dashed">Tracejada</option>
                  <option value="dotted">Pontilhada</option>
                </select>
              </label>
              <label>
                Direção
                <select v-model="selected.item.direction" @change="invalidateTikz">
                  <option value="->">-&gt;</option>
                  <option value="<->">&lt;-&gt;</option>
                  <option value="-">-</option>
                </select>
              </label>
              <label>
                Trajeto
                <select v-model="selected.item.shape" @change="invalidateTikz">
                  <option value="--">Reta</option>
                  <option value="|-">90° (primeiro horizontal)</option>
                  <option value="-|">90° (primeiro vertical)</option>
                  <option value="bend left">Curva para a esquerda</option>
                  <option value="bend right">Curva para a direita</option>
                </select>
              </label>
              <label v-if="selected.item.shape?.startsWith('bend')">
                Curvatura
                <input type="range" min="10" max="60" v-model="selected.item.bend" @input="invalidateTikz">
              </label>
              <button class="ghost" @click="removeSelected">Remover Aresta</button>
            </div>
            <div v-else class="empty-state">Selecione uma aresta para ajustar suas opções.</div>
          </section>
        </div>
      </section>

      <aside class="sidebar">
        <section class="panel">
          <header><h2>Status</h2></header>
          <div class="panel-content">
            <p>{{ statusMessage }}</p>
            <ul class="tips">
              <li>Use CTRL/CMD + Clique para selecionar múltiplos itens (em breve).</li>
              <li>Arraste nós utilizando a ferramenta <strong>Mover</strong>.</li>
            </ul>
          </div>
        </section>
        <section class="panel code-panel">
          <header><h2>Código TikZ</h2></header>
          <textarea readonly :value="tikzCode" aria-label="Código gerado"></textarea>
        </section>
      </aside>
    </main>
  </div>

  <script type="module" src="main.js"></script>
</body>
</html>
